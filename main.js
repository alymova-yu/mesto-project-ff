(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-13",headers:{authorization:"bba36d42-d80f-49ca-ae96-738b7761565d","Content-Type":"application/json"}};function t(e){if(e.ok)return e.json();console.log("Ошибка: ".concat(e.status))}function n(t){fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).catch((function(e){console.log(e)}))}function o(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then((function(e){return t(e)})).catch((function(e){console.log(e)}))}function r(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)})).catch((function(e){console.log(e)}))}var c=document.querySelector("#card-template").content;function a(e,t,n,o,r,a,u,i){var l=c.querySelector(".places__item").cloneNode(!0),s=l.querySelector(".card__image"),d=l.querySelector(".card__like-button"),p=l.querySelector(".card__like-number"),_=l.querySelector(".card__delete-button");e.owner._id!==r&&(_.style.display="none"),s.src=e.link,s.alt=e.name,l.id=e._id,p.textContent=e.likes.length,l.querySelector(".card__title").textContent=e.name,_.addEventListener("click",(function(){a(e._id),t(l)}));var f=[];return e.likes.forEach((function(e){f.push(e._id)})),f.includes(r)&&n(d),d.addEventListener("click",(function(t){d.classList.contains("card__like-button_is-active")?(n(t.target),Promise.all([i(e._id)]).then((function(e){p.textContent=e[0].likes.length})).catch((function(){console.log("Запрос не удался")}))):(n(t.target),Promise.all([u(e._id)]).then((function(e){p.textContent=e[0].likes.length})).catch((function(){console.log("Запрос не удался")})))})),s.addEventListener("click",(function(){return o(e)})),l}function u(e){e.remove()}function i(e){e.classList.toggle("card__like-button_is-active")}var l="Escape";function s(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",_),e.addEventListener("click",d)}function d(e){(e.target.classList.contains("popup__close")||e.target===e.currentTarget)&&p(e.currentTarget)}function p(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",_),e.removeEventListener("click",d)}function _(e){e.key===l&&p(document.querySelector(".popup_is-opened"))}var f=document.forms.newPlace,v=document.forms.newAvatar,m=f.querySelector(".popup__input_type_card-name"),y=f.querySelector(".popup__input_type_url"),h=v.querySelector(".popup__input_type_avatar");function S(e,t,n){var o=n.inactiveButtonClass,r=void 0===o?"":o;!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(r)):(t.disabled=!0,t.classList.add(r))}function b(e,t){var n=t.submitButtonSelector,o=void 0===n?"":n,r=t.inputSelector,c=void 0===r?"":r,a=t.inputErrorClass,u=void 0===a?"":a,i=t.errorClass,l=void 0===i?"":i,s=e.querySelector(o),d=Array.from(e.querySelectorAll(c));m.value="",y.value="",h.value="",d.forEach((function(t){t.classList.remove(u);var n=e.querySelector(".".concat(t.id,"-error"));n.classList.remove(l),n.textContent=""})),S(d,s,C)}var q,g,C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},E=document.querySelector(".places__list"),L=document.querySelector(".popup_type_edit"),k=document.querySelector(".popup_type_new-card"),x=document.querySelector(".popup_type_new-avatar"),A=document.querySelector(".popup__image"),P=document.querySelector(".popup__caption"),U=document.querySelector(".popup_type_image"),w=document.forms.editProfile,T=w.querySelector(".popup__input_type_name"),D=w.querySelector(".popup__input_type_description"),B=v.querySelector(".popup__input_type_avatar"),N=document.querySelector(".profile__edit-button"),O=document.querySelector(".profile__add-button"),J=document.querySelectorAll(".popup"),M=document.querySelector(".profile__title"),j=document.querySelector(".profile__description"),H=document.querySelector(".profile__image"),V=document.querySelector(".popup__input_type_card-name"),z=document.querySelector(".popup__input_type_url");function I(e){M.textContent=e.name,j.textContent=e.about,H.style.backgroundImage="url("+e.avatar+")"}function F(n){n.preventDefault();var o,r,c=n.target.querySelector(".popup__button");c.textContent="Сохранение...",Promise.all([(o=T.value,r=D.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:r})}).then((function(e){return t(e)})).catch((function(e){console.log(e)})))]).then((function(e){I(e[0]),p(L),c.textContent="Сохранить"}))}function G(e){A.setAttribute("src",e.link),A.setAttribute("alt",e.name),P.textContent=e.name,s(U)}function K(c){c.preventDefault();var l,s,d=c.target.querySelector(".popup__button");d.textContent="Сохранение...",Promise.all([(l=V.value,s=z.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:l,link:s})}).then((function(e){return t(e)})).catch((function(e){console.log(e)})))]).then((function(e){var t=e[0].owner._id,c=a(e[0],u,i,G,t,n,o,r);E.prepend(c)})),f.reset(),p(k),d.textContent="Сохранить"}function Q(n){n.preventDefault();var o,r=n.target.querySelector(".popup__button");r.textContent="Сохранение...",Promise.all([(o=B.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then((function(e){return t(e)})).catch((function(e){console.log(e)})))]).then((function(e){I(e[0]),p(x),r.textContent="Сохранить"}))}J.forEach((function(e){e.classList.add("popup_is-animated")})),N.addEventListener("click",(function(){T.value=M.textContent,D.value=j.textContent,b(w,C),s(L)})),O.addEventListener("click",(function(){b(f,C),s(k)})),H.addEventListener("click",(function(){b(v,C),s(x)})),g=void 0===(q=C.formSelector)?"":q,Array.from(document.querySelectorAll(g)).forEach((function(e){e.addEventListener("sumit",(function(e){e.preventDefault()})),function(e,t){var n=t.inputSelector,o=void 0===n?"":n,r=t.submitButtonSelector,c=void 0===r?"":r,a=Array.from(e.querySelectorAll(o)),u=e.querySelector(c);a.forEach((function(t){t.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=n.inputErrorClass,r=void 0===o?"":o,c=n.errorClass,a=void 0===c?"":c,u=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r),u.classList.remove(a),u.textContent=""}(e,t,C):function(e,t,n,o){var r=o.inputErrorClass,c=void 0===r?"":r,a=o.errorClass,u=void 0===a?"":a,i=e.querySelector(".".concat(t.id,"-error"));t.classList.add(c),i.textContent=n,i.classList.add(u)}(e,t,t.validationMessage,C)}(e,t),S(a,u,C)}))}))}(e,C)})),Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return t(e)})).catch((function(e){console.log(e)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return t(e)})).catch((function(e){console.log(e)}))]).then((function(e){e[1].forEach((function(t){var c=a(t,u,i,G,e[0]._id,n,o,r);E.append(c)})),w.addEventListener("submit",F),f.addEventListener("submit",K),v.addEventListener("submit",Q),I(e[0])}))})();